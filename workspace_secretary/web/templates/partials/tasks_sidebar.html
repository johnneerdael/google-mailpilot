<div class="space-y-3">
    <div class="flex items-center justify-between">
        <h3 class="text-sm font-semibold text-body">Tasks</h3>
        <a href="/tasks" class="text-xs text-primary hover:text-blue-400 transition-colors">
            View all
        </a>
    </div>

    {% if tasks %}
    <div class="space-y-2">
        {% for task in tasks %}
        <div class="group flex items-start gap-2 p-2 rounded-md hover:bg-surface-hover transition-colors"
             x-data="{ loading: false }">
            <button @click="loading = true; fetch('/api/tasks/{{ task.id }}/toggle', {method: 'POST'}).then(r => r.json()).then(d => { if(d.success) { htmx.trigger(document.body, 'refreshTasks'); } loading = false; })"
                    class="mt-0.5 flex-shrink-0 w-4 h-4 rounded border transition-colors"
                    :class="loading ? 'border-primary animate-pulse' : 'border-border hover:border-primary'"
                    :disabled="loading">
                {% if task.completed %}
                <svg class="w-4 h-4 text-primary" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                </svg>
                {% endif %}
            </button>
            <div class="flex-1 min-w-0">
                <p class="text-xs text-body truncate {% if task.completed %}line-through text-muted{% endif %}">
                    {{ task.description }}
                </p>
                <div class="flex items-center gap-2 mt-1">
                    <span class="px-1.5 py-0.5 text-[10px] rounded
                        {% if task.priority == 'high' %}bg-red-900/50 text-red-400
                        {% elif task.priority == 'medium' %}bg-yellow-900/50 text-yellow-400
                        {% else %}bg-surface-subtle text-muted{% endif %}">
                        {{ task.priority }}
                    </span>
                    {% if task.due_date %}
                    <span class="text-[10px] text-muted">ðŸ“… {{ task.due_date }}</span>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    
    {% if has_more %}
    <a href="/tasks" class="block text-center text-xs text-muted hover:text-body py-2">
        +{{ total_tasks - tasks|length }} more tasks
    </a>
    {% endif %}
    {% else %}
    <div class="text-center py-4">
        <p class="text-xs text-muted">No pending tasks</p>
        <button @click="$dispatch('open-add-task')"
                class="mt-2 text-xs text-primary hover:text-blue-400 transition-colors">
            + Add a task
        </button>
    </div>
    {% endif %}

    <button @click="$dispatch('open-add-task')"
            class="w-full py-2 text-xs text-muted hover:text-body hover:bg-surface-hover rounded-md transition-colors">
        + Add task
    </button>
</div>
