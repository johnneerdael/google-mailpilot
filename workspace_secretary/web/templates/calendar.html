{% extends "base.html" %}
{% block title %}Calendar - Secretary{% endblock %}

{% block content %}
<div class="space-y-4" x-data="{ 
    showEventDetail: false, 
    selectedEvent: null,
    showSettings: false,
    visibleCalendars: ['primary'],
    secondaryTimezone: null,
    showWorkingHours: true,
    openEventDetail(event) {
        this.selectedEvent = event;
        this.showEventDetail = true;
    },
    toggleCalendar(calendarId) {
        const index = this.visibleCalendars.indexOf(calendarId);
        if (index > -1) {
            this.visibleCalendars.splice(index, 1);
        } else {
            this.visibleCalendars.push(calendarId);
        }
    },
    isWorkingHour(hour) {
        return hour >= 11 && hour < 22;
    }
}">
    {% if engine_error %}
    <div class="bg-red-900/90 border border-red-700 text-red-100 px-4 py-3 rounded">
        <div class="flex items-center gap-2">
            <span>‚ö†Ô∏è</span>
            <span>{{ engine_error }}</span>
        </div>
    </div>
    {% endif %}

    <div class="flex items-center justify-between flex-wrap gap-4">
        <div class="flex items-center space-x-2">
            <h1 class="h1">Calendar</h1>
            <div class="flex bg-surface-subtle rounded-md overflow-hidden border border-border">
                <a href="/calendar?view=week" 
                   class="px-3 py-1 text-sm transition-colors {% if view == 'week' %}bg-primary text-white{% else %}text-muted hover:text-body hover:bg-surface-hover{% endif %}">
                    Week
                </a>
                <a href="/calendar?view=day" 
                   class="px-3 py-1 text-sm transition-colors {% if view == 'day' %}bg-primary text-white{% else %}text-muted hover:text-body hover:bg-surface-hover{% endif %}">
                    Day
                </a>
                <a href="/calendar?view=month" 
                   class="px-3 py-1 text-sm transition-colors {% if view == 'month' %}bg-primary text-white{% else %}text-muted hover:text-body hover:bg-surface-hover{% endif %}">
                    Month
                </a>
                <a href="/calendar?view=agenda" 
                   class="px-3 py-1 text-sm transition-colors {% if view == 'agenda' %}bg-primary text-white{% else %}text-muted hover:text-body hover:bg-surface-hover{% endif %}">
                    Agenda
                </a>
            </div>
            <button @click="showSettings = !showSettings" 
                    class="btn-icon"
                    :class="{ 'bg-surface-subtle text-primary': showSettings }"
                    title="Calendar settings">
                ‚öôÔ∏è
            </button>
        </div>
        
        <div class="flex items-center space-x-2">
            {% if view == 'week' %}
            <a href="/calendar?view=week&week_offset={{ week_offset - 1 }}" 
               class="btn-icon text-sm">
                ‚Üê Prev
            </a>
            <span class="text-sm text-muted font-medium">
                {{ week_start.strftime('%b %d') }} - {{ week_end.strftime('%b %d, %Y') }}
            </span>
            <a href="/calendar?view=week&week_offset={{ week_offset + 1 }}" 
               class="btn-icon text-sm">
                Next ‚Üí
            </a>
            {% if week_offset != 0 %}
            <a href="/calendar?view=week" class="px-3 py-1 text-sm text-primary hover:text-blue-600 dark:hover:text-blue-400 no-underline">
                Today
            </a>
            {% endif %}
            <a href="/calendar/find-time" class="btn-primary no-underline ml-2">
                üîç Find a Time
            </a>
            {% elif view == 'day' %}
            <a href="/calendar?view=day&day_offset={{ day_offset - 1 }}" 
               class="btn-icon text-sm">
                ‚Üê Prev
            </a>
            <span class="text-sm text-muted font-medium">
                {{ target_day.strftime('%A, %B %d, %Y') }}
            </span>
            <a href="/calendar?view=day&day_offset={{ day_offset + 1 }}" 
               class="btn-icon text-sm">
                Next ‚Üí
            </a>
            {% if day_offset != 0 %}
            <a href="/calendar?view=day" class="px-3 py-1 text-sm text-primary hover:text-blue-600 dark:hover:text-blue-400 no-underline">
                Today
            </a>
            {% endif %}
            {% elif view == 'month' %}
            <a href="/calendar?view=month&month_offset={{ month_offset - 1 }}" 
               class="btn-icon text-sm">
                ‚Üê Prev
            </a>
            <span class="text-sm text-muted font-medium">
                {{ month_name }}
            </span>
            <a href="/calendar?view=month&month_offset={{ month_offset + 1 }}" 
               class="btn-icon text-sm">
                Next ‚Üí
            </a>
            {% if month_offset != 0 %}
            <a href="/calendar?view=month" class="px-3 py-1 text-sm text-primary hover:text-blue-600 dark:hover:text-blue-400 no-underline">
                This Month
            </a>
            {% endif %}
            {% elif view == 'agenda' %}
            <span class="text-sm text-muted">Next 30 days</span>
            {% endif %}
        </div>
    </div>

    <div x-show="showSettings" x-cloak x-collapse class="card space-y-4">
        <div>
            <h3 class="h2 mb-2">Calendars</h3>
            <div class="space-y-2">
                <label class="flex items-center space-x-2 cursor-pointer">
                    <input type="checkbox" 
                           x-model="visibleCalendars" 
                           value="primary"
                           class="rounded bg-surface-subtle border-border text-primary focus:ring-primary">
                    <span class="text-sm text-body">Primary Calendar</span>
                </label>
            </div>
        </div>
        
        <div>
            <h3 class="h2 mb-2">Timezone</h3>
            <div class="text-xs text-muted mb-2">Primary: Europe/Amsterdam (CET/CEST)</div>
            <select x-model="secondaryTimezone" 
                    class="input-field text-sm">
                <option value="">No secondary timezone</option>
                <option value="America/New_York">New York (EST/EDT)</option>
                <option value="America/Los_Angeles">Los Angeles (PST/PDT)</option>
                <option value="Europe/London">London (GMT/BST)</option>
                <option value="Asia/Tokyo">Tokyo (JST)</option>
                <option value="Asia/Singapore">Singapore (SGT)</option>
                <option value="Australia/Sydney">Sydney (AEDT/AEST)</option>
            </select>
        </div>
        
        <div>
            <h3 class="h2 mb-2">Display</h3>
            <label class="flex items-center space-x-2 cursor-pointer">
                <input type="checkbox" 
                       x-model="showWorkingHours"
                       class="rounded bg-surface-subtle border-border text-primary focus:ring-primary">
                <span class="text-sm text-body">Highlight working hours (11:00 - 22:00)</span>
            </label>
        </div>
    </div>

    {% if view == 'day' %}
    <div class="bg-surface rounded-lg overflow-hidden border border-border shadow-sm">
        <div class="grid grid-cols-[80px_1fr]">
            <div class="border-r border-border"></div>
            <div class="bg-surface-subtle px-4 py-2 border-b border-border">
                <span class="text-sm font-medium text-body">{{ target_day.strftime('%A, %B %d') }}</span>
            </div>
            
            {% for hour in range(24) %}
            <div class="border-r border-border px-2 py-2 text-xs text-muted text-right"
                 :style="showWorkingHours && isWorkingHour({{ hour }}) ? 'background-color: rgba(59, 130, 246, 0.05);' : ''">
                {{ '%02d:00'|format(hour) }}
            </div>
            <div class="border-t border-border min-h-[60px] relative"
                 :style="showWorkingHours && isWorkingHour({{ hour }}) ? 'background-color: rgba(59, 130, 246, 0.03);' : ''">
                {% for event in day_events %}
                {% if event.start.dateTime %}
                {% set event_hour = event.start.dateTime[11:13]|int %}
                {% if event_hour == hour %}
                <div class="absolute left-0 right-0 mx-1 mt-1 bg-primary/10 border-l-2 border-primary rounded p-2 text-xs cursor-pointer hover:bg-primary/20 transition-colors"
                     @click="openEventDetail({{ event|tojson }})">
                    <div class="font-medium text-body flex items-center gap-1">
                        {{ event.start.dateTime[11:16] }} {{ event.summary }}
                        {% if event._local_status == 'pending' %}
                        <span class="text-[10px] px-1.5 py-0.5 rounded bg-yellow-900/30 text-yellow-400 border border-yellow-700/50">‚è± Pending</span>
                        {% elif event._local_status == 'conflict' %}
                        <span class="text-[10px] px-1.5 py-0.5 rounded bg-red-900/30 text-red-400 border border-red-700/50">‚ö† Conflict</span>
                        {% endif %}
                    </div>
                    {% if event.location %}
                    <div class="text-muted mt-1 truncate">üìç {{ event.location }}</div>
                    {% endif %}
                    <template x-if="busy_slots && busy_slots.length > 0">
                        <div class="absolute inset-0 bg-red-500/10 pointer-events-none"></div>
                    </template>
                </div>
                {% endif %}
                {% elif event.start.date and hour == 0 %}
                <div class="absolute left-0 right-0 mx-1 mt-1 bg-green-500/10 border-l-2 border-green-500 rounded p-2 text-xs cursor-pointer hover:bg-green-500/20 transition-colors"
                     @click="openEventDetail({{ event|tojson }})">
                    <div class="font-medium text-body flex items-center gap-1">
                        üåÖ All Day: {{ event.summary }}
                        {% if event._local_status == 'pending' %}
                        <span class="text-[10px] px-1.5 py-0.5 rounded bg-yellow-900/30 text-yellow-400 border border-yellow-700/50">‚è± Pending</span>
                        {% elif event._local_status == 'conflict' %}
                        <span class="text-[10px] px-1.5 py-0.5 rounded bg-red-900/30 text-red-400 border border-red-700/50">‚ö† Conflict</span>
                        {% endif %}
                    </div>
                    {% if event.location %}
                    <div class="text-muted mt-1 truncate">üìç {{ event.location }}</div>
                    {% endif %}
                </div>
                {% endif %}
                {% endfor %}
            </div>
            {% endfor %}
        </div>
    </div>
    
    {% elif view == 'month' %}
    <div class="bg-surface rounded-lg overflow-hidden border border-border shadow-sm">
        <div class="grid grid-cols-7 border-b border-border bg-surface-subtle">
            {% for day_name in ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'] %}
            <div class="px-2 py-2 text-center text-xs font-medium text-muted">{{ day_name }}</div>
            {% endfor %}
        </div>
        
        {% for week in weeks %}
        <div class="grid grid-cols-7 border-b border-border last:border-b-0">
            {% for day in week %}
            <div class="border-r border-border last:border-r-0 p-2 min-h-[100px] {% if not day.is_current_month %}bg-canvas/50{% endif %} {% if day.is_today %}ring-1 ring-primary inset-ring{% endif %}">
                <div class="text-xs {% if day.is_today %}text-primary font-bold{% elif day.is_current_month %}text-muted{% else %}text-muted/50{% endif %} mb-1">
                    {{ day.day_num }}
                </div>
                <div class="space-y-1">
                    {% for event in day.events[:3] %}
                    <div class="text-xs px-1 py-0.5 rounded bg-primary/10 text-primary truncate cursor-pointer hover:bg-primary/20 transition-colors"
                         @click="openEventDetail({{ event|tojson }})">
                        <div class="flex items-center gap-1">
                            {% if event.start.dateTime %}{{ event.start.dateTime[11:16] }}{% else %}üåÖ{% endif %} {{ event.summary }}
                            {% if event._local_status == 'pending' %}
                            <span class="text-[9px] px-1 py-0.5 rounded bg-yellow-900/30 text-yellow-400">‚è±</span>
                            {% elif event._local_status == 'conflict' %}
                            <span class="text-[9px] px-1 py-0.5 rounded bg-red-900/30 text-red-400">‚ö†</span>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                    {% if day.events|length > 3 %}
                    <div class="text-xs text-muted">+{{ day.events|length - 3 }} more</div>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
        {% endfor %}
    </div>
    
    {% elif view == 'agenda' %}
    <div class="space-y-4">
        {% for date, events_list in grouped_events.items() %}
        <div class="card p-0 overflow-hidden">
            <div class="bg-surface-subtle px-4 py-2 border-b border-border">
                <span class="text-sm font-medium text-body">
                    {% set first_event = events_list[0] %}
                    {% if first_event.start.dateTime %}
                    {{ first_event.start.dateTime | strftime('%A, %B %d, %Y') }}
                    {% elif first_event.start.date %}
                    {{ first_event.start.date | strftime('%A, %B %d, %Y') }}
                    {% endif %}
                </span>
            </div>
            <div class="divide-y divide-border">
                {% for event in events_list %}
                <div class="px-4 py-3 hover:bg-surface-subtle cursor-pointer transition-colors"
                     @click="openEventDetail({{ event|tojson }})">
                    <div class="flex items-start justify-between">
                        <div class="flex-1">
                            <div class="font-medium text-body flex items-center gap-2">
                                {{ event.summary }}
                                {% if event._local_status == 'pending' %}
                                <span class="text-xs px-2 py-0.5 rounded bg-yellow-900/30 text-yellow-400 border border-yellow-700/50">‚è± Pending sync</span>
                                {% elif event._local_status == 'conflict' %}
                                <span class="text-xs px-2 py-0.5 rounded bg-red-900/30 text-red-400 border border-red-700/50">‚ö† Conflict</span>
                                {% endif %}
                            </div>
                            {% if event.location %}
                            <div class="text-sm text-muted mt-1">üìç {{ event.location }}</div>
                            {% endif %}
                            {% if event.attendees %}
                            <div class="text-sm text-muted mt-1">{{ event.attendees|length }} attendees</div>
                            {% endif %}
                        </div>
                        <div class="text-sm text-muted ml-4">
                            {% if event.start.dateTime %}
                            {{ event.start.dateTime[11:16] }}
                            {% if event.end.dateTime %}
                            - {{ event.end.dateTime[11:16] }}
                            {% endif %}
                            {% elif event.start.date %}
                            üåÖ All Day
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% else %}
            {% with icon="üìÖ", title="No upcoming events", description="No events scheduled for the next 30 days." %}
                {% include "partials/empty_state.html" %}
            {% endwith %}
        {% endfor %}
    </div>
    
    {% else %}
    <div class="grid grid-cols-7 gap-2">
        {% for day in days %}
        <div class="card p-3 min-h-[200px] {% if day.is_today %}ring-2 ring-primary{% endif %}">
            <div class="flex items-center justify-between mb-2">
                <span class="text-sm font-medium {% if day.is_today %}text-primary{% else %}text-muted{% endif %}">
                    {{ day.name }}
                </span>
                <span class="text-xs text-muted">{{ day.short }}</span>
            </div>
            <div class="space-y-1">
                {% for event in day.events %}
                <div class="text-xs p-2 rounded bg-surface-subtle hover:bg-surface-hover cursor-pointer transition-colors"
                     @click="openEventDetail({{ event|tojson }})">
                    <div class="flex items-start justify-between">
                        <div class="flex-1 min-w-0">
                            <div class="font-medium text-body truncate">{{ event.summary }}</div>
                            {% if event._local_status == 'pending' %}
                            <div class="text-[9px] text-yellow-400 mt-0.5">‚è± Pending</div>
                            {% elif event._local_status == 'conflict' %}
                            <div class="text-[9px] text-red-400 mt-0.5">‚ö† Conflict</div>
                            {% endif %}
                        </div>
                        {% if event.start.dateTime %}
                        <span class="text-muted ml-1">
                            {{ event.start.dateTime[11:16] }}
                        </span>
                        {% elif event.start.date %}
                        <span class="text-muted ml-1">üåÖ</span>
                        {% endif %}
                    </div>
                </div>
                {% else %}
                <p class="text-xs text-muted italic">No events</p>
                {% endfor %}
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <div class="flex justify-end">
        <button @click="$dispatch('open-create-event')"
                class="btn-primary">
            + New Event
        </button>
    </div>

    <template x-if="showEventDetail && selectedEvent">
        <div class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4" @click.self="showEventDetail = false">
            <div class="bg-surface rounded-xl shadow-2xl border border-border w-full max-w-2xl max-h-[90vh] flex flex-col">
                <div class="flex items-center justify-between px-6 py-4 border-b border-border bg-surface rounded-t-xl sticky top-0">
                    <div class="flex items-center gap-2">
                        <h2 class="h2" x-text="selectedEvent?.summary"></h2>
                        <span x-show="selectedEvent?._local_status === 'pending'" 
                              class="text-xs px-2 py-1 rounded bg-yellow-900/30 text-yellow-400 border border-yellow-700/50">‚è± Pending sync</span>
                        <span x-show="selectedEvent?._local_status === 'conflict'" 
                              class="text-xs px-2 py-1 rounded bg-red-900/30 text-red-400 border border-red-700/50">‚ö† Conflict</span>
                    </div>
                    <button @click="showEventDetail = false" class="text-muted hover:text-body p-1 rounded-md hover:bg-surface-subtle">‚úï</button>
                </div>
                
                <div class="p-6 space-y-4 overflow-y-auto">
                    <div x-show="selectedEvent?.start?.dateTime" class="flex items-start space-x-3">
                        <span class="text-2xl">üïê</span>
                        <div>
                            <div class="text-sm text-muted">Time</div>
                            <div class="text-body">
                                <span x-text="selectedEvent?.start?.dateTime ? new Date(selectedEvent.start.dateTime).toLocaleString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' }) : ''"></span>
                            </div>
                            <div class="text-body mt-1">
                                <span x-text="selectedEvent?.start?.dateTime ? selectedEvent.start.dateTime.substring(11, 16) : ''"></span>
                                <span x-show="selectedEvent?.end?.dateTime"> - </span>
                                <span x-text="selectedEvent?.end?.dateTime ? selectedEvent.end.dateTime.substring(11, 16) : ''"></span>
                            </div>
                        </div>
                    </div>

                    <div x-show="selectedEvent?.start?.date && !selectedEvent?.start?.dateTime" class="flex items-start space-x-3">
                        <span class="text-2xl">üåÖ</span>
                        <div>
                            <div class="text-sm text-muted">All Day Event</div>
                            <div class="text-body">
                                <span x-text="selectedEvent?.start?.date ? new Date(selectedEvent.start.date + 'T00:00:00').toLocaleString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' }) : ''"></span>
                            </div>
                        </div>
                    </div>

                    <div x-show="selectedEvent?.description" class="flex items-start space-x-3">
                        <span class="text-2xl">üìù</span>
                        <div class="flex-1">
                            <div class="text-sm text-muted">Description</div>
                            <div class="text-body whitespace-pre-wrap" x-text="selectedEvent?.description"></div>
                        </div>
                    </div>
                    
                    <div x-show="selectedEvent?.location" class="flex items-start space-x-3">
                        <span class="text-2xl">üìç</span>
                        <div class="flex-1">
                            <div class="text-sm text-muted">Location</div>
                            <div class="text-body" x-text="selectedEvent?.location"></div>
                        </div>
                    </div>
                    
                    <div x-show="selectedEvent?.hangoutLink" class="flex items-start space-x-3">
                        <span class="text-2xl">üé•</span>
                        <div class="flex-1">
                            <div class="text-sm text-muted">Video Conference</div>
                            <a :href="selectedEvent?.hangoutLink" target="_blank" 
                               class="link">
                                Join Google Meet
                            </a>
                        </div>
                    </div>
                    
                    <div x-show="selectedEvent?.attendees && selectedEvent.attendees.length > 0" class="flex items-start space-x-3">
                        <span class="text-2xl">üë•</span>
                        <div class="flex-1">
                            <div class="text-sm text-muted mb-2">
                                Attendees (<span x-text="selectedEvent?.attendees?.length || 0"></span>)
                            </div>
                            <div class="space-y-2">
                                <template x-for="attendee in selectedEvent?.attendees || []" :key="attendee.email">
                                    <div class="flex items-center justify-between text-sm">
                                        <div>
                                            <span class="text-body" x-text="attendee.displayName || attendee.email"></span>
                                            <span class="text-muted" x-show="attendee.displayName"> 
                                                (<span x-text="attendee.email"></span>)
                                            </span>
                                        </div>
                                        <span class="badge"
                                              :class="{
                                                  'badge-success': attendee.responseStatus === 'accepted',
                                                  'badge-error': attendee.responseStatus === 'declined',
                                                  'badge-warning': attendee.responseStatus === 'tentative',
                                                  'badge-neutral': attendee.responseStatus === 'needsAction'
                                              }"
                                              x-text="attendee.responseStatus === 'accepted' ? 'Accepted' : 
                                                      attendee.responseStatus === 'declined' ? 'Declined' : 
                                                      attendee.responseStatus === 'tentative' ? 'Maybe' : 'No response'">
                                        </span>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>

                    <div x-show="selectedEvent?.organizer" class="flex items-start space-x-3">
                        <span class="text-2xl">üë§</span>
                        <div class="flex-1">
                            <div class="text-sm text-muted">Organizer</div>
                            <div class="text-body">
                                <span x-text="selectedEvent?.organizer?.displayName || selectedEvent?.organizer?.email"></span>
                            </div>
                        </div>
                    </div>
                    
                    <div x-show="selectedEvent?.htmlLink" class="flex items-start space-x-3">
                        <span class="text-2xl">üîó</span>
                        <div class="flex-1">
                            <div class="text-sm text-muted">Calendar Link</div>
                            <a :href="selectedEvent?.htmlLink" target="_blank" 
                               class="link text-sm">
                                View in Google Calendar
                            </a>
                        </div>
                    </div>
                </div>
                
                <div class="flex justify-between space-x-2 px-6 py-4 border-t border-border bg-surface-subtle rounded-b-xl">
                    <button @click="$dispatch('propose-times', { event: selectedEvent })"
                            class="btn-secondary text-xs">
                        üìÖ Propose New Times
                    </button>
                    <button @click="showEventDetail = false"
                            class="btn-secondary">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </template>

    <template x-if="$store.proposeTimesEvent">
        <div class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4" 
             @click.self="$store.proposeTimesEvent = null"
             x-data="{
                 proposedSlots: [],
                 message: '',
                 async proposeAlternatives() {
                     const formData = new FormData();
                     formData.append('event_id', $store.proposeTimesEvent.id);
                     formData.append('proposed_times', JSON.stringify(proposedSlots));
                     formData.append('message', message);
                     
                     try {
                         const response = await fetch('/api/calendar/propose-times', {
                             method: 'POST',
                             body: formData
                         });
                         const data = await response.json();
                         
                         if (data.success) {
                             window.showToast('Alternative times proposed', 'success');
                             $store.proposeTimesEvent = null;
                         } else {
                             window.showToast(data.error || 'Failed to propose times', 'error');
                         }
                     } catch (error) {
                         window.showToast('Error proposing times', 'error');
                     }
                 },
                 addSlot() {
                     const now = new Date();
                     proposedSlots.push({
                         start: now.toISOString().slice(0, 16),
                         end: new Date(now.getTime() + 30 * 60000).toISOString().slice(0, 16)
                     });
                 },
                 removeSlot(index) {
                     proposedSlots.splice(index, 1);
                 }
             }"
             x-init="addSlot()"
             @propose-times.window="$store.proposeTimesEvent = $event.detail.event">
            <div class="bg-surface rounded-xl shadow-2xl border border-border w-full max-w-2xl max-h-[90vh] flex flex-col">
                <div class="flex items-center justify-between px-6 py-4 border-b border-border bg-surface rounded-t-xl sticky top-0">
                    <h2 class="h2">Propose Alternative Times</h2>
                    <button @click="$store.proposeTimesEvent = null" class="text-muted hover:text-body p-1 rounded-md hover:bg-surface-subtle">‚úï</button>
                </div>
                
                <div class="p-6 space-y-4 overflow-y-auto">
                    <div class="card bg-surface-subtle">
                        <div class="text-sm text-muted">Current Event</div>
                        <div class="text-body font-medium" x-text="$store.proposeTimesEvent?.summary"></div>
                        <div class="text-sm text-muted mt-1">
                            <span x-text="$store.proposeTimesEvent?.start?.dateTime ? new Date($store.proposeTimesEvent.start.dateTime).toLocaleString() : ''"></span>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-body mb-2">
                            Proposed Alternative Times
                        </label>
                        <div class="space-y-3">
                            <template x-for="(slot, index) in proposedSlots" :key="index">
                                <div class="flex items-center gap-2">
                                    <input type="datetime-local" 
                                           x-model="slot.start"
                                           class="flex-1 input-field text-sm">
                                    <span class="text-muted">to</span>
                                    <input type="datetime-local" 
                                           x-model="slot.end"
                                           class="flex-1 input-field text-sm">
                                    <button @click="removeSlot(index)" 
                                            class="p-2 text-red-500 hover:text-red-700">
                                        ‚úï
                                    </button>
                                </div>
                            </template>
                        </div>
                        <button @click="addSlot()" 
                                class="mt-2 btn-secondary text-sm">
                            + Add Another Time Slot
                        </button>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-body mb-2">
                            Message (optional)
                        </label>
                        <textarea x-model="message"
                                  rows="3"
                                  placeholder="Let attendees know why you're proposing new times..."
                                  class="input-field w-full"></textarea>
                    </div>
                </div>
                
                <div class="flex justify-end space-x-2 px-6 py-4 border-t border-border bg-surface-subtle rounded-b-xl">
                    <button @click="$store.proposeTimesEvent = null"
                            class="btn-secondary">
                        Cancel
                    </button>
                    <button @click="proposeAlternatives()"
                            class="btn-primary">
                        Send Proposals
                    </button>
                </div>
            </div>
        </div>
    </template>
</div>

<script>
document.addEventListener('alpine:init', () => {
    Alpine.store('proposeTimesEvent', null);
});
</script>
{% endblock %}
